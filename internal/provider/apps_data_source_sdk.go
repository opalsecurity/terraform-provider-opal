// Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.

package provider

import (
	"context"
	"encoding/json"
	"github.com/hashicorp/terraform-plugin-framework/diag"
	"github.com/hashicorp/terraform-plugin-framework/types"
	"github.com/opalsecurity/terraform-provider-opal/v3/internal/provider/typeconvert"
	tfTypes "github.com/opalsecurity/terraform-provider-opal/v3/internal/provider/types"
	"github.com/opalsecurity/terraform-provider-opal/v3/internal/sdk/models/operations"
	"github.com/opalsecurity/terraform-provider-opal/v3/internal/sdk/models/shared"
)

func (r *AppsDataSourceModel) RefreshFromSharedAppsList(ctx context.Context, resp *shared.AppsList) diag.Diagnostics {
	var diags diag.Diagnostics

	if resp != nil {
		r.Apps = []tfTypes.App{}

		for _, appsItem := range resp.Apps {
			var apps tfTypes.App

			apps.AdminOwnerID = types.StringValue(appsItem.AdminOwnerID)
			apps.Description = types.StringValue(appsItem.Description)
			apps.ID = types.StringValue(appsItem.ID)
			apps.Name = types.StringValue(appsItem.Name)
			apps.Type = types.StringValue(appsItem.Type)
			apps.Validations = []tfTypes.AppValidation{}

			for _, validationsItem := range appsItem.Validations {
				var validations tfTypes.AppValidation

				validations.Details = types.StringPointerValue(validationsItem.Details)
				validations.Key = types.StringValue(validationsItem.Key)
				nameResult, _ := json.Marshal(validationsItem.Name)
				validations.Name = types.StringValue(string(nameResult))
				validations.Severity = types.StringValue(string(validationsItem.Severity))
				validations.Status = types.StringValue(string(validationsItem.Status))
				validations.UpdatedAt = types.StringValue(typeconvert.TimeToString(validationsItem.UpdatedAt))
				validations.UsageReason = types.StringPointerValue(validationsItem.UsageReason)

				apps.Validations = append(apps.Validations, validations)
			}

			r.Apps = append(r.Apps, apps)
		}
	}

	return diags
}

func (r *AppsDataSourceModel) ToOperationsGetAppsRequest(ctx context.Context) (*operations.GetAppsRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	appTypeFilter := make([]shared.AppTypeEnum, 0, len(r.AppTypeFilter))
	for _, appTypeFilterItem := range r.AppTypeFilter {
		appTypeFilter = append(appTypeFilter, shared.AppTypeEnum(appTypeFilterItem.ValueString()))
	}
	ownerFilter := new(string)
	if !r.OwnerFilter.IsUnknown() && !r.OwnerFilter.IsNull() {
		*ownerFilter = r.OwnerFilter.ValueString()
	} else {
		ownerFilter = nil
	}
	out := operations.GetAppsRequest{
		AppTypeFilter: appTypeFilter,
		OwnerFilter:   ownerFilter,
	}

	return &out, diags
}
