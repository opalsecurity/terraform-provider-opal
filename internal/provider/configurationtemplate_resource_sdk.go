// Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.

package provider

import (
	"context"
	"github.com/hashicorp/terraform-plugin-framework/diag"
	"github.com/hashicorp/terraform-plugin-framework/types"
	tfTypes "github.com/opalsecurity/terraform-provider-opal/v3/internal/provider/types"
	"github.com/opalsecurity/terraform-provider-opal/v3/internal/sdk/models/operations"
	"github.com/opalsecurity/terraform-provider-opal/v3/internal/sdk/models/shared"
)

func (r *ConfigurationTemplateResourceModel) RefreshFromSharedConfigurationTemplate(ctx context.Context, resp *shared.ConfigurationTemplate) diag.Diagnostics {
	var diags diag.Diagnostics

	if resp != nil {
		r.AdminOwnerID = types.StringPointerValue(resp.AdminOwnerID)
		r.BreakGlassUserIds = make([]types.String, 0, len(resp.BreakGlassUserIds))
		for _, v := range resp.BreakGlassUserIds {
			r.BreakGlassUserIds = append(r.BreakGlassUserIds, types.StringValue(v))
		}
		r.ConfigurationTemplateID = types.StringPointerValue(resp.ConfigurationTemplateID)
		r.CustomRequestNotification = types.StringPointerValue(resp.CustomRequestNotification)
		r.LinkedAuditMessageChannelIds = make([]types.String, 0, len(resp.LinkedAuditMessageChannelIds))
		for _, v := range resp.LinkedAuditMessageChannelIds {
			r.LinkedAuditMessageChannelIds = append(r.LinkedAuditMessageChannelIds, types.StringValue(v))
		}
		r.MemberOnCallScheduleIds = make([]types.String, 0, len(resp.MemberOnCallScheduleIds))
		for _, v := range resp.MemberOnCallScheduleIds {
			r.MemberOnCallScheduleIds = append(r.MemberOnCallScheduleIds, types.StringValue(v))
		}
		r.Name = types.StringPointerValue(resp.Name)
		r.RequestConfigurationID = types.StringPointerValue(resp.RequestConfigurationID)
		r.RequireMfaToApprove = types.BoolPointerValue(resp.RequireMfaToApprove)
		r.RequireMfaToConnect = types.BoolPointerValue(resp.RequireMfaToConnect)
		if resp.TicketPropagation == nil {
			r.TicketPropagation = nil
		} else {
			r.TicketPropagation = &tfTypes.TicketPropagationConfiguration{}
			r.TicketPropagation.EnabledOnGrant = types.BoolValue(resp.TicketPropagation.EnabledOnGrant)
			r.TicketPropagation.EnabledOnRevocation = types.BoolValue(resp.TicketPropagation.EnabledOnRevocation)
			r.TicketPropagation.TicketProjectID = types.StringPointerValue(resp.TicketPropagation.TicketProjectID)
			if resp.TicketPropagation.TicketProvider != nil {
				r.TicketPropagation.TicketProvider = types.StringValue(string(*resp.TicketPropagation.TicketProvider))
			} else {
				r.TicketPropagation.TicketProvider = types.StringNull()
			}
		}
		if resp.Visibility != nil {
			r.Visibility.Visibility = types.StringValue(string(resp.Visibility.Visibility))
			r.Visibility.VisibilityGroupIds = make([]types.String, 0, len(resp.Visibility.VisibilityGroupIds))
			for _, v := range resp.Visibility.VisibilityGroupIds {
				r.Visibility.VisibilityGroupIds = append(r.Visibility.VisibilityGroupIds, types.StringValue(v))
			}
		}
	}

	return diags
}

func (r *ConfigurationTemplateResourceModel) ToOperationsDeleteConfigurationTemplateRequest(ctx context.Context) (*operations.DeleteConfigurationTemplateRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	var configurationTemplateID string
	configurationTemplateID = r.ConfigurationTemplateID.ValueString()

	out := operations.DeleteConfigurationTemplateRequest{
		ConfigurationTemplateID: configurationTemplateID,
	}

	return &out, diags
}

func (r *ConfigurationTemplateResourceModel) ToSharedCreateConfigurationTemplateInfo(ctx context.Context) (*shared.CreateConfigurationTemplateInfo, diag.Diagnostics) {
	var diags diag.Diagnostics

	var adminOwnerID string
	adminOwnerID = r.AdminOwnerID.ValueString()

	breakGlassUserIds := make([]string, 0, len(r.BreakGlassUserIds))
	for _, breakGlassUserIdsItem := range r.BreakGlassUserIds {
		breakGlassUserIds = append(breakGlassUserIds, breakGlassUserIdsItem.ValueString())
	}
	customRequestNotification := new(string)
	if !r.CustomRequestNotification.IsUnknown() && !r.CustomRequestNotification.IsNull() {
		*customRequestNotification = r.CustomRequestNotification.ValueString()
	} else {
		customRequestNotification = nil
	}
	linkedAuditMessageChannelIds := make([]string, 0, len(r.LinkedAuditMessageChannelIds))
	for _, linkedAuditMessageChannelIdsItem := range r.LinkedAuditMessageChannelIds {
		linkedAuditMessageChannelIds = append(linkedAuditMessageChannelIds, linkedAuditMessageChannelIdsItem.ValueString())
	}
	memberOnCallScheduleIds := make([]string, 0, len(r.MemberOnCallScheduleIds))
	for _, memberOnCallScheduleIdsItem := range r.MemberOnCallScheduleIds {
		memberOnCallScheduleIds = append(memberOnCallScheduleIds, memberOnCallScheduleIdsItem.ValueString())
	}
	var name string
	name = r.Name.ValueString()

	requestConfigurations := make([]shared.RequestConfiguration, 0, len(r.RequestConfigurations))
	for _, requestConfigurationsItem := range r.RequestConfigurations {
		var allowRequests bool
		allowRequests = requestConfigurationsItem.AllowRequests.ValueBool()

		var autoApproval bool
		autoApproval = requestConfigurationsItem.AutoApproval.ValueBool()

		var condition *shared.Condition
		if requestConfigurationsItem.Condition != nil {
			groupIds := make([]string, 0, len(requestConfigurationsItem.Condition.GroupIds))
			for _, groupIdsItem := range requestConfigurationsItem.Condition.GroupIds {
				groupIds = append(groupIds, groupIdsItem.ValueString())
			}
			roleRemoteIds := make([]string, 0, len(requestConfigurationsItem.Condition.RoleRemoteIds))
			for _, roleRemoteIdsItem := range requestConfigurationsItem.Condition.RoleRemoteIds {
				roleRemoteIds = append(roleRemoteIds, roleRemoteIdsItem.ValueString())
			}
			condition = &shared.Condition{
				GroupIds:      groupIds,
				RoleRemoteIds: roleRemoteIds,
			}
		}
		extensionsDurationInMinutes := new(int64)
		if !requestConfigurationsItem.ExtensionsDurationInMinutes.IsUnknown() && !requestConfigurationsItem.ExtensionsDurationInMinutes.IsNull() {
			*extensionsDurationInMinutes = requestConfigurationsItem.ExtensionsDurationInMinutes.ValueInt64()
		} else {
			extensionsDurationInMinutes = nil
		}
		maxDuration := new(int64)
		if !requestConfigurationsItem.MaxDuration.IsUnknown() && !requestConfigurationsItem.MaxDuration.IsNull() {
			*maxDuration = requestConfigurationsItem.MaxDuration.ValueInt64()
		} else {
			maxDuration = nil
		}
		var priority int64
		priority = requestConfigurationsItem.Priority.ValueInt64()

		recommendedDuration := new(int64)
		if !requestConfigurationsItem.RecommendedDuration.IsUnknown() && !requestConfigurationsItem.RecommendedDuration.IsNull() {
			*recommendedDuration = requestConfigurationsItem.RecommendedDuration.ValueInt64()
		} else {
			recommendedDuration = nil
		}
		requestTemplateID := new(string)
		if !requestConfigurationsItem.RequestTemplateID.IsUnknown() && !requestConfigurationsItem.RequestTemplateID.IsNull() {
			*requestTemplateID = requestConfigurationsItem.RequestTemplateID.ValueString()
		} else {
			requestTemplateID = nil
		}
		var requireMfaToRequest bool
		requireMfaToRequest = requestConfigurationsItem.RequireMfaToRequest.ValueBool()

		var requireSupportTicket bool
		requireSupportTicket = requestConfigurationsItem.RequireSupportTicket.ValueBool()

		reviewerStages := make([]shared.ReviewerStage, 0, len(requestConfigurationsItem.ReviewerStages))
		for _, reviewerStagesItem := range requestConfigurationsItem.ReviewerStages {
			operator := new(shared.Operator)
			if !reviewerStagesItem.Operator.IsUnknown() && !reviewerStagesItem.Operator.IsNull() {
				*operator = shared.Operator(reviewerStagesItem.Operator.ValueString())
			} else {
				operator = nil
			}
			ownerIds := make([]string, 0, len(reviewerStagesItem.OwnerIds))
			for _, ownerIdsItem := range reviewerStagesItem.OwnerIds {
				ownerIds = append(ownerIds, ownerIdsItem.ValueString())
			}
			requireAdminApproval := new(bool)
			if !reviewerStagesItem.RequireAdminApproval.IsUnknown() && !reviewerStagesItem.RequireAdminApproval.IsNull() {
				*requireAdminApproval = reviewerStagesItem.RequireAdminApproval.ValueBool()
			} else {
				requireAdminApproval = nil
			}
			requireManagerApproval := new(bool)
			if !reviewerStagesItem.RequireManagerApproval.IsUnknown() && !reviewerStagesItem.RequireManagerApproval.IsNull() {
				*requireManagerApproval = reviewerStagesItem.RequireManagerApproval.ValueBool()
			} else {
				requireManagerApproval = nil
			}
			reviewerStages = append(reviewerStages, shared.ReviewerStage{
				Operator:               operator,
				OwnerIds:               ownerIds,
				RequireAdminApproval:   requireAdminApproval,
				RequireManagerApproval: requireManagerApproval,
			})
		}
		requestConfigurations = append(requestConfigurations, shared.RequestConfiguration{
			AllowRequests:               allowRequests,
			AutoApproval:                autoApproval,
			Condition:                   condition,
			ExtensionsDurationInMinutes: extensionsDurationInMinutes,
			MaxDuration:                 maxDuration,
			Priority:                    priority,
			RecommendedDuration:         recommendedDuration,
			RequestTemplateID:           requestTemplateID,
			RequireMfaToRequest:         requireMfaToRequest,
			RequireSupportTicket:        requireSupportTicket,
			ReviewerStages:              reviewerStages,
		})
	}
	requireMfaToApprove := new(bool)
	if !r.RequireMfaToApprove.IsUnknown() && !r.RequireMfaToApprove.IsNull() {
		*requireMfaToApprove = r.RequireMfaToApprove.ValueBool()
	} else {
		requireMfaToApprove = nil
	}
	var requireMfaToConnect bool
	requireMfaToConnect = r.RequireMfaToConnect.ValueBool()

	var ticketPropagation *shared.TicketPropagationConfiguration
	if r.TicketPropagation != nil {
		var enabledOnGrant bool
		enabledOnGrant = r.TicketPropagation.EnabledOnGrant.ValueBool()

		var enabledOnRevocation bool
		enabledOnRevocation = r.TicketPropagation.EnabledOnRevocation.ValueBool()

		ticketProjectID := new(string)
		if !r.TicketPropagation.TicketProjectID.IsUnknown() && !r.TicketPropagation.TicketProjectID.IsNull() {
			*ticketProjectID = r.TicketPropagation.TicketProjectID.ValueString()
		} else {
			ticketProjectID = nil
		}
		ticketProvider := new(shared.TicketingProviderEnum)
		if !r.TicketPropagation.TicketProvider.IsUnknown() && !r.TicketPropagation.TicketProvider.IsNull() {
			*ticketProvider = shared.TicketingProviderEnum(r.TicketPropagation.TicketProvider.ValueString())
		} else {
			ticketProvider = nil
		}
		ticketPropagation = &shared.TicketPropagationConfiguration{
			EnabledOnGrant:      enabledOnGrant,
			EnabledOnRevocation: enabledOnRevocation,
			TicketProjectID:     ticketProjectID,
			TicketProvider:      ticketProvider,
		}
	}
	visibility1 := shared.VisibilityTypeEnum(r.Visibility.Visibility.ValueString())
	visibilityGroupIds := make([]string, 0, len(r.Visibility.VisibilityGroupIds))
	for _, visibilityGroupIdsItem := range r.Visibility.VisibilityGroupIds {
		visibilityGroupIds = append(visibilityGroupIds, visibilityGroupIdsItem.ValueString())
	}
	visibility := shared.VisibilityInfo{
		Visibility:         visibility1,
		VisibilityGroupIds: visibilityGroupIds,
	}
	out := shared.CreateConfigurationTemplateInfo{
		AdminOwnerID:                 adminOwnerID,
		BreakGlassUserIds:            breakGlassUserIds,
		CustomRequestNotification:    customRequestNotification,
		LinkedAuditMessageChannelIds: linkedAuditMessageChannelIds,
		MemberOnCallScheduleIds:      memberOnCallScheduleIds,
		Name:                         name,
		RequestConfigurations:        requestConfigurations,
		RequireMfaToApprove:          requireMfaToApprove,
		RequireMfaToConnect:          requireMfaToConnect,
		TicketPropagation:            ticketPropagation,
		Visibility:                   visibility,
	}

	return &out, diags
}

func (r *ConfigurationTemplateResourceModel) ToSharedUpdateConfigurationTemplateInfo(ctx context.Context) (*shared.UpdateConfigurationTemplateInfo, diag.Diagnostics) {
	var diags diag.Diagnostics

	adminOwnerID := new(string)
	if !r.AdminOwnerID.IsUnknown() && !r.AdminOwnerID.IsNull() {
		*adminOwnerID = r.AdminOwnerID.ValueString()
	} else {
		adminOwnerID = nil
	}
	breakGlassUserIds := make([]string, 0, len(r.BreakGlassUserIds))
	for _, breakGlassUserIdsItem := range r.BreakGlassUserIds {
		breakGlassUserIds = append(breakGlassUserIds, breakGlassUserIdsItem.ValueString())
	}
	var configurationTemplateID string
	configurationTemplateID = r.ConfigurationTemplateID.ValueString()

	customRequestNotification := new(string)
	if !r.CustomRequestNotification.IsUnknown() && !r.CustomRequestNotification.IsNull() {
		*customRequestNotification = r.CustomRequestNotification.ValueString()
	} else {
		customRequestNotification = nil
	}
	linkedAuditMessageChannelIds := make([]string, 0, len(r.LinkedAuditMessageChannelIds))
	for _, linkedAuditMessageChannelIdsItem := range r.LinkedAuditMessageChannelIds {
		linkedAuditMessageChannelIds = append(linkedAuditMessageChannelIds, linkedAuditMessageChannelIdsItem.ValueString())
	}
	memberOnCallScheduleIds := make([]string, 0, len(r.MemberOnCallScheduleIds))
	for _, memberOnCallScheduleIdsItem := range r.MemberOnCallScheduleIds {
		memberOnCallScheduleIds = append(memberOnCallScheduleIds, memberOnCallScheduleIdsItem.ValueString())
	}
	name := new(string)
	if !r.Name.IsUnknown() && !r.Name.IsNull() {
		*name = r.Name.ValueString()
	} else {
		name = nil
	}
	requestConfigurations := make([]shared.RequestConfiguration, 0, len(r.RequestConfigurations))
	for _, requestConfigurationsItem := range r.RequestConfigurations {
		var allowRequests bool
		allowRequests = requestConfigurationsItem.AllowRequests.ValueBool()

		var autoApproval bool
		autoApproval = requestConfigurationsItem.AutoApproval.ValueBool()

		var condition *shared.Condition
		if requestConfigurationsItem.Condition != nil {
			groupIds := make([]string, 0, len(requestConfigurationsItem.Condition.GroupIds))
			for _, groupIdsItem := range requestConfigurationsItem.Condition.GroupIds {
				groupIds = append(groupIds, groupIdsItem.ValueString())
			}
			roleRemoteIds := make([]string, 0, len(requestConfigurationsItem.Condition.RoleRemoteIds))
			for _, roleRemoteIdsItem := range requestConfigurationsItem.Condition.RoleRemoteIds {
				roleRemoteIds = append(roleRemoteIds, roleRemoteIdsItem.ValueString())
			}
			condition = &shared.Condition{
				GroupIds:      groupIds,
				RoleRemoteIds: roleRemoteIds,
			}
		}
		extensionsDurationInMinutes := new(int64)
		if !requestConfigurationsItem.ExtensionsDurationInMinutes.IsUnknown() && !requestConfigurationsItem.ExtensionsDurationInMinutes.IsNull() {
			*extensionsDurationInMinutes = requestConfigurationsItem.ExtensionsDurationInMinutes.ValueInt64()
		} else {
			extensionsDurationInMinutes = nil
		}
		maxDuration := new(int64)
		if !requestConfigurationsItem.MaxDuration.IsUnknown() && !requestConfigurationsItem.MaxDuration.IsNull() {
			*maxDuration = requestConfigurationsItem.MaxDuration.ValueInt64()
		} else {
			maxDuration = nil
		}
		var priority int64
		priority = requestConfigurationsItem.Priority.ValueInt64()

		recommendedDuration := new(int64)
		if !requestConfigurationsItem.RecommendedDuration.IsUnknown() && !requestConfigurationsItem.RecommendedDuration.IsNull() {
			*recommendedDuration = requestConfigurationsItem.RecommendedDuration.ValueInt64()
		} else {
			recommendedDuration = nil
		}
		requestTemplateID := new(string)
		if !requestConfigurationsItem.RequestTemplateID.IsUnknown() && !requestConfigurationsItem.RequestTemplateID.IsNull() {
			*requestTemplateID = requestConfigurationsItem.RequestTemplateID.ValueString()
		} else {
			requestTemplateID = nil
		}
		var requireMfaToRequest bool
		requireMfaToRequest = requestConfigurationsItem.RequireMfaToRequest.ValueBool()

		var requireSupportTicket bool
		requireSupportTicket = requestConfigurationsItem.RequireSupportTicket.ValueBool()

		reviewerStages := make([]shared.ReviewerStage, 0, len(requestConfigurationsItem.ReviewerStages))
		for _, reviewerStagesItem := range requestConfigurationsItem.ReviewerStages {
			operator := new(shared.Operator)
			if !reviewerStagesItem.Operator.IsUnknown() && !reviewerStagesItem.Operator.IsNull() {
				*operator = shared.Operator(reviewerStagesItem.Operator.ValueString())
			} else {
				operator = nil
			}
			ownerIds := make([]string, 0, len(reviewerStagesItem.OwnerIds))
			for _, ownerIdsItem := range reviewerStagesItem.OwnerIds {
				ownerIds = append(ownerIds, ownerIdsItem.ValueString())
			}
			requireAdminApproval := new(bool)
			if !reviewerStagesItem.RequireAdminApproval.IsUnknown() && !reviewerStagesItem.RequireAdminApproval.IsNull() {
				*requireAdminApproval = reviewerStagesItem.RequireAdminApproval.ValueBool()
			} else {
				requireAdminApproval = nil
			}
			requireManagerApproval := new(bool)
			if !reviewerStagesItem.RequireManagerApproval.IsUnknown() && !reviewerStagesItem.RequireManagerApproval.IsNull() {
				*requireManagerApproval = reviewerStagesItem.RequireManagerApproval.ValueBool()
			} else {
				requireManagerApproval = nil
			}
			reviewerStages = append(reviewerStages, shared.ReviewerStage{
				Operator:               operator,
				OwnerIds:               ownerIds,
				RequireAdminApproval:   requireAdminApproval,
				RequireManagerApproval: requireManagerApproval,
			})
		}
		requestConfigurations = append(requestConfigurations, shared.RequestConfiguration{
			AllowRequests:               allowRequests,
			AutoApproval:                autoApproval,
			Condition:                   condition,
			ExtensionsDurationInMinutes: extensionsDurationInMinutes,
			MaxDuration:                 maxDuration,
			Priority:                    priority,
			RecommendedDuration:         recommendedDuration,
			RequestTemplateID:           requestTemplateID,
			RequireMfaToRequest:         requireMfaToRequest,
			RequireSupportTicket:        requireSupportTicket,
			ReviewerStages:              reviewerStages,
		})
	}
	requireMfaToApprove := new(bool)
	if !r.RequireMfaToApprove.IsUnknown() && !r.RequireMfaToApprove.IsNull() {
		*requireMfaToApprove = r.RequireMfaToApprove.ValueBool()
	} else {
		requireMfaToApprove = nil
	}
	requireMfaToConnect := new(bool)
	if !r.RequireMfaToConnect.IsUnknown() && !r.RequireMfaToConnect.IsNull() {
		*requireMfaToConnect = r.RequireMfaToConnect.ValueBool()
	} else {
		requireMfaToConnect = nil
	}
	var ticketPropagation *shared.TicketPropagationConfiguration
	if r.TicketPropagation != nil {
		var enabledOnGrant bool
		enabledOnGrant = r.TicketPropagation.EnabledOnGrant.ValueBool()

		var enabledOnRevocation bool
		enabledOnRevocation = r.TicketPropagation.EnabledOnRevocation.ValueBool()

		ticketProjectID := new(string)
		if !r.TicketPropagation.TicketProjectID.IsUnknown() && !r.TicketPropagation.TicketProjectID.IsNull() {
			*ticketProjectID = r.TicketPropagation.TicketProjectID.ValueString()
		} else {
			ticketProjectID = nil
		}
		ticketProvider := new(shared.TicketingProviderEnum)
		if !r.TicketPropagation.TicketProvider.IsUnknown() && !r.TicketPropagation.TicketProvider.IsNull() {
			*ticketProvider = shared.TicketingProviderEnum(r.TicketPropagation.TicketProvider.ValueString())
		} else {
			ticketProvider = nil
		}
		ticketPropagation = &shared.TicketPropagationConfiguration{
			EnabledOnGrant:      enabledOnGrant,
			EnabledOnRevocation: enabledOnRevocation,
			TicketProjectID:     ticketProjectID,
			TicketProvider:      ticketProvider,
		}
	}
	var visibility *shared.VisibilityInfo
	visibility1 := shared.VisibilityTypeEnum(r.Visibility.Visibility.ValueString())
	visibilityGroupIds := make([]string, 0, len(r.Visibility.VisibilityGroupIds))
	for _, visibilityGroupIdsItem := range r.Visibility.VisibilityGroupIds {
		visibilityGroupIds = append(visibilityGroupIds, visibilityGroupIdsItem.ValueString())
	}
	visibility = &shared.VisibilityInfo{
		Visibility:         visibility1,
		VisibilityGroupIds: visibilityGroupIds,
	}
	out := shared.UpdateConfigurationTemplateInfo{
		AdminOwnerID:                 adminOwnerID,
		BreakGlassUserIds:            breakGlassUserIds,
		ConfigurationTemplateID:      configurationTemplateID,
		CustomRequestNotification:    customRequestNotification,
		LinkedAuditMessageChannelIds: linkedAuditMessageChannelIds,
		MemberOnCallScheduleIds:      memberOnCallScheduleIds,
		Name:                         name,
		RequestConfigurations:        requestConfigurations,
		RequireMfaToApprove:          requireMfaToApprove,
		RequireMfaToConnect:          requireMfaToConnect,
		TicketPropagation:            ticketPropagation,
		Visibility:                   visibility,
	}

	return &out, diags
}
